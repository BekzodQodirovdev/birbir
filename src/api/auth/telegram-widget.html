<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Telegram Login Example</title>
  </head>
  <body>
    <h1>Telegram Login Example</h1>

    <!-- Telegram Login Widget -->
    <script
      async
      src="https://telegram.org/js/telegram-widget.js?22"
      data-telegram-login="birbir_authbot"
      data-size="large"
      data-auth-url="https://4e09110d09f9.ngrok-free.app/api/auth/telegram"
      data-request-access="write"
    ></script>

    <!-- Alternative: Custom Telegram Login Button -->
    <div id="telegram-login-button"></div>

    <script>
      // Use the backend URL for authentication
      const BACKEND_URL = 'https://4e09110d09f9.ngrok-free.app';

      // Function to initialize Telegram Login Widget
      function initTelegramLogin() {
        const script = document.createElement('script');
        script.src = 'https://telegram.org/js/telegram-widget.js?22';
        script.async = true;
        script.setAttribute('data-telegram-login', 'birbir_authbot');
        script.setAttribute('data-size', 'large');
        script.setAttribute(
          'data-auth-url',
          `${BACKEND_URL}/api/auth/telegram`,
        );
        script.setAttribute('data-request-access', 'write');
        document.getElementById('telegram-login-button').appendChild(script);
      }

      // Initialize the widget
      initTelegramLogin();

      // Handle login success
      window.handleTelegramLogin = function (data) {
        console.log('Telegram login data:', data);

        // Send data to backend for verification
        fetch(`${BACKEND_URL}/api/auth/telegram`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        })
          .then((response) => response.json())
          .then((result) => {
            if (result.success) {
              // Store token in localStorage or sessionStorage
              localStorage.setItem('access_token', result.access_token);
              console.log('Login successful:', result);
              // Redirect to dashboard or home page
              window.location.href = '/dashboard';
            } else {
              console.error('Login failed:', result.message);
            }
          })
          .catch((error) => {
            console.error('Error:', error);
          });
      };
    </script>
  </body>
</html>
